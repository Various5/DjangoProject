{% extends 'base.html' %}
{% load static %}

{% block title %}Computacenter RMA{% endblock %}

{% block content %}
<div class="container my-4">
    <h1 class="mb-4">Computacenter RMA</h1>

    <!-- CREATE NEW TICKET FORM -->
    <form method="post" action="" class="mb-5 border p-3 bg-light">
        {% csrf_token %}
        <h2 class="h5 mb-3">Neues Ticket erstellen</h2>
        <div class="row mb-3">
            <div class="col">
                <label for="ticketnummer" class="form-label">Ticketnummer</label>
                <input type="text" name="ticketnummer" id="ticketnummer" class="form-control" required>
            </div>
            <div class="col">
                <label for="firma" class="form-label">Firma</label>
                <input type="text" name="firma" id="firma" class="form-control">
            </div>
            <div class="col">
                <label for="modell" class="form-label">Modell</label>
                <input type="text" name="modell" id="modell" class="form-control">
            </div>
            <div class="col">
                <label for="seriennummer" class="form-label">Seriennummer</label>
                <input type="text" name="seriennummer" id="seriennummer" class="form-control">
            </div>
        </div>
        <div class="mb-3">
            <label for="fehler" class="form-label">Fehler</label>
            <textarea name="fehler" id="fehler" rows="3" class="form-control"></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Ticket erstellen</button>
    </form>

    <!-- SEARCH FORM -->
    <form method="get" action="" class="mb-4">
        <div class="row g-2">
            <div class="col-auto">
                <input type="text" name="q" value="{{ query|default_if_none:'' }}"
                       class="form-control" placeholder="Search all fields...">
            </div>
            <div class="col-auto">
                <button class="btn btn-secondary" type="submit">Suchen</button>
            </div>
        </div>
    </form>

    <!-- OPEN TICKETS -->
    <h2 class="h4">Offene Tickets</h2>
    {% if open_tickets %}
    <table class="table table-striped mb-5">
        <thead>
            <tr>
                <th>ID</th>
                <th>Ticketnummer</th>
                <th>Firma</th>
                <th>Modell</th>
                <th>Seriennummer</th>
                <th>Fehler</th>
                <th>Erstellt am</th>
                <th>Status</th>
                <th>Aktionen</th>
            </tr>
        </thead>
        <tbody>
            {% for ticket in open_tickets %}
            <tr>
                <td>{{ ticket.id }}</td>
                <td>{{ ticket.ticketnummer }}</td>
                <td>{{ ticket.firma }}</td>
                <td>{{ ticket.modell }}</td>
                <td>{{ ticket.seriennummer }}</td>
                <td>{{ ticket.fehler }}</td>
                <td>{{ ticket.created_at }}</td>
                <td>{{ ticket.abgeschlossen|yesno:"Abgeschlossen,Offen" }}</td>
                <td>
                    <!-- ACTION BUTTONS -->
                    <a href="{% url 'edit_ticket' ticket.id %}"
                       class="btn btn-sm btn-outline-primary me-1">
                       Edit
                    </a>
                    <a href="{% url 'delete_ticket' ticket.id %}"
                       class="btn btn-sm btn-outline-danger me-1">
                       Delete
                    </a>
                    <a href="{% url 'print_ticket' ticket.id %}"
                       class="btn btn-sm btn-outline-info me-1">
                       Print
                    </a>
                    <a href="{% url 'pdf_ticket' ticket.id %}"
                       class="btn btn-sm btn-outline-secondary me-1">
                       PDF
                    </a>
                    <a href="{% url 'close_ticket_view' ticket.id %}"
                       class="btn btn-sm btn-outline-success">
                       Close
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="text-muted">Keine offenen Tickets gefunden.</p>
    {% endif %}

    <!-- CLOSED TICKETS -->
    <h2 class="h4">Abgeschlossene Tickets (Archiv)</h2>
    {% if closed_tickets %}
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>Ticketnummer</th>
                <th>Firma</th>
                <th>Modell</th>
                <th>Seriennummer</th>
                <th>Fehler</th>
                <th>Erstellt am</th>
                <th>Status</th>
                <th>Aktionen</th>
            </tr>
        </thead>
        <tbody>
            {% for ticket in closed_tickets %}
            <tr>
                <td>{{ ticket.id }}</td>
                <td>{{ ticket.ticketnummer }}</td>
                <td>{{ ticket.firma }}</td>
                <td>{{ ticket.modell }}</td>
                <td>{{ ticket.seriennummer }}</td>
                <td>{{ ticket.fehler }}</td>
                <td>{{ ticket.created_at }}</td>
                <td>{{ ticket.abgeschlossen|yesno:"Abgeschlossen,Offen" }}</td>
                <td>
                    <!-- ACTION BUTTONS -->
                    <a href="{% url 'edit_ticket' ticket.id %}"
                       class="btn btn-sm btn-outline-primary me-1">
                       Edit
                    </a>
                    <a href="{% url 'delete_ticket' ticket.id %}"
                       class="btn btn-sm btn-outline-danger me-1">
                       Delete
                    </a>
                    <a href="{% url 'print_ticket' ticket.id %}"
                       class="btn btn-sm btn-outline-info me-1">
                       Print
                    </a>
                    <a href="{% url 'pdf_ticket' ticket.id %}"
                       class="btn btn-sm btn-outline-secondary me-1">
                       PDF
                    </a>
                    <a href="{% url 'reopen_ticket_view' ticket.id %}"
                       class="btn btn-sm btn-outline-warning">
                       Reopen
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="text-muted">Keine abgeschlossenen Tickets.</p>
    {% endif %}
</div>
{% endblock %}
